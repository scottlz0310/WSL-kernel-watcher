# 要件定義書

## はじめに

WSLカーネル安定版リリース監視ツールは、Microsoft公式のWSL2 Linuxカーネルリポジトリ（microsoft/WSL2-Linux-Kernel）を監視し、新しい安定版リリースが公開された際にWindowsトースト通知でユーザーに知らせる常駐型アプリケーションです。複数PC・複数WSLディストリビューションで開発を行うユーザーが、カーネルの更新を見逃すことなく、最新の安定版を利用できるようにすることを目的としています。

## 要件

### 要件1

**ユーザーストーリー:** 開発者として、WSL2カーネルの新しい安定版リリースを自動的に検知したい。そうすることで、手動でGitHubリポジトリを確認する手間を省き、常に最新の安定版カーネルを利用できる。

#### 受け入れ基準

1. WHEN アプリケーションが起動した時 THEN システムはGitHub APIを使用してmicrosoft/WSL2-Linux-Kernelリポジトリの最新リリース情報を取得する SHALL
2. WHEN GitHub APIからリリース情報を取得する時 THEN システムはプレリリース（RC版、プレビュー版）を除外して安定版のみを対象とする SHALL
3. WHEN GitHub APIへのアクセスでエラーが発生した時 THEN システムはリトライ機能を使用して最大3回まで再試行する SHALL
4. WHEN GitHub APIのレート制限に達した時 THEN システムは適切な待機時間を設けて制限解除後に再試行する SHALL

### 要件2

**ユーザーストーリー:** 開発者として、現在使用中のWSLカーネルバージョンと最新の安定版を比較したい。そうすることで、更新が必要かどうかを自動的に判断できる。

#### 受け入れ基準

1. WHEN システムがバージョン比較を実行する時 THEN `wsl uname -r`コマンドを使用して現在のWSLカーネルバージョンを取得する SHALL
2. WHEN WSLコマンドの実行でエラーが発生した時 THEN システムは適切なエラーハンドリングを行い、ユーザーに分かりやすいエラーメッセージを表示する SHALL
3. WHEN 現在のカーネルバージョンと最新リリースバージョンを比較する時 THEN システムはセマンティックバージョニングに基づいて正確な比較を行う SHALL
4. IF 最新リリースが現在のバージョンより新しい場合 THEN システムは更新が利用可能であることを記録する SHALL

### 要件3

**ユーザーストーリー:** 開発者として、新しいカーネルバージョンが利用可能になった時にWindowsトースト通知を受け取りたい。そうすることで、作業を中断することなく更新情報を把握できる。

#### 受け入れ基準

1. WHEN 新しい安定版カーネルが検出された時 THEN システムはWindowsトースト通知を表示する SHALL
2. WHEN トースト通知を表示する時 THEN 通知には新しいバージョン番号と現在のバージョン番号を含める SHALL
3. WHEN トースト通知を表示する時 THEN 通知はWindows 10およびWindows 11で正常に動作する SHALL
4. WHEN ユーザーがトースト通知をクリックした時 THEN システムは適切なアクション（設定可能）を実行する SHALL

### 要件4

**ユーザーストーリー:** 開発者として、アプリケーションをWindowsタスクトレイに常駐させたい。そうすることで、システムリソースを最小限に抑えながら継続的な監視を行える。

#### 受け入れ基準

1. WHEN アプリケーションが起動した時 THEN システムはWindowsタスクトレイにアイコンを表示する SHALL
2. WHEN タスクトレイアイコンを右クリックした時 THEN システムはコンテキストメニューを表示する SHALL
3. WHEN コンテキストメニューから「終了」を選択した時 THEN システムは適切にアプリケーションを終了する SHALL
4. WHEN 新しいバージョンが利用可能な時 THEN システムはタスクトレイアイコンの表示を「更新あり」状態に変更する SHALL
5. WHEN システムが定期チェックを実行する時 THEN デフォルトで30分間隔でGitHub APIをチェックする SHALL

### 要件5

**ユーザーストーリー:** 開発者として、アプリケーションの動作を設定ファイルでカスタマイズしたい。そうすることで、チェック間隔やリポジトリURLなどを自分の環境に合わせて調整できる。

#### 受け入れ基準

1. WHEN アプリケーションが起動した時 THEN システムは`config.toml`ファイルから設定を読み込む SHALL
2. IF 設定ファイルが存在しない場合 THEN システムはデフォルト設定でconfig.tomlファイルを作成する SHALL
3. WHEN 設定ファイルを読み込む時 THEN システムはチェック間隔、リポジトリURL、通知設定を取得する SHALL
4. WHEN 設定ファイルの形式が不正な場合 THEN システムは適切なエラーメッセージを表示してデフォルト設定で動作を継続する SHALL

### 要件6

**ユーザーストーリー:** 開発者として、通知をクリックした時にWSLでのカーネルビルド手順を自動的に開始したい。そうすることで、更新プロセスを効率化できる。

#### 受け入れ基準

1. WHEN ユーザーがトースト通知をクリックした時 AND 設定でビルドアクションが有効な場合 THEN システムはWSL環境でカーネルビルドスクリプトを実行する SHALL
2. WHEN ビルドスクリプトを実行する時 THEN システムは実行状況をユーザーに表示する SHALL
3. WHEN ビルドスクリプトの実行でエラーが発生した時 THEN システムは適切なエラーハンドリングを行い、ユーザーに分かりやすいエラーメッセージを表示する SHALL
4. IF ビルドアクションが設定で無効な場合 THEN システムは通知クリック時に何も実行しない SHALL

### 要件7

**ユーザーストーリー:** 開発者として、アプリケーションのログを確認したい。そうすることで、問題が発生した時にトラブルシューティングを行える。

#### 受け入れ基準

1. WHEN アプリケーションが動作する時 THEN システムは適切なログレベル（DEBUG、INFO、WARNING、ERROR）でログを出力する SHALL
2. WHEN ログを出力する時 THEN システムはloggingモジュールを使用してprint関数は使用しない SHALL
3. WHEN ログファイルを作成する時 THEN システムはユーザーのAppDataディレクトリ内にログファイルを保存する SHALL
4. WHEN ログファイルのサイズが制限を超えた時 THEN システムはログローテーションを実行する SHALL